let selected_element=null,to_rank_div=document.getElementById("to-rank"),to_rank_input=document.getElementById("to-rank-input"),construct_item=e=>{let t=new Image;return t.dataset.drag="",t.src=e,t.draggable=!1,t.classList.add("item"),t},insert_element=(e,t)=>{e!==t&&(e.remove(),"label"in t.dataset&&t.parentElement.append(e),"items"in t.dataset&&t.append(e),"drag"in t.dataset&&t.parentNode.insertBefore(e,t.nextSibling),"row"in t.dataset&&t.children[1].append(e))},drag_start=e=>"drag"in e.target.dataset?selected_element=e.target:null,drag_move=e=>{selected_element&&(selected_element.style.position="absolute",selected_element.style.left=e.clientX+window.scrollX-selected_element.clientWidth/2+"px",selected_element.style.top=e.clientY+window.scrollY-selected_element.clientHeight/2+"px")},drag_end=e=>{if(selected_element){let t=document.elementsFromPoint(e.clientX,e.clientY)[1];["items","drag","row","label"].some((e=>e in t.dataset))&&insert_element(selected_element,t),selected_element.style.position=null,selected_element.style.left=null,selected_element.style.top=null,selected_element=null}};window.addEventListener("touchstart",drag_start),window.addEventListener("touchmove",(e=>{drag_move(e.touches[0])})),window.addEventListener("touchend",(e=>{drag_end(e.touches[0])})),window.addEventListener("mousedown",drag_start),window.addEventListener("mousemove",drag_move),window.addEventListener("mouseup",drag_end),window.addEventListener("drop",(e=>{e.preventDefault();let t=e.target;if(["items","drag","row","label"].some((e=>e in t.dataset)))for(const n of e.dataTransfer.files){let e=new FileReader;e.onload=e=>{insert_element(construct_item(e.target.result),t)},e.readAsDataURL(n)}})),window.addEventListener("dragover",(e=>{e.preventDefault()}));let input_images=e=>{for(const t of e){let e=new FileReader;e.onload=e=>{to_rank_div.prepend(construct_item(e.target.result))},e.readAsDataURL(t)}};to_rank_input&&to_rank_input.addEventListener("input",(e=>{input_images(e.target.files)}));let rank_input_click=()=>{1===to_rank_div.children.length&&to_rank_input.click()},save_blob=(e,t)=>{const n=window.URL.createObjectURL(e),l=document.createElement("a");document.body.appendChild(l),l.style.display="none",l.href=n,l.download=t,l.click()},tier_title=document.getElementById("tier-title"),create_tier=()=>{html2canvas(document.querySelector("#capture")).then((e=>{e.toBlob((e=>{let t=tier_title.value?`${tier_title.value}.png`:"tier.png";save_blob(e,t)}))}))};
